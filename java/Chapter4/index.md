# 第2节：index

## 索引 概念

索引是存储引擎用于快速找到记录的一种数据结构

tips:索引是一种数据结构 数据结构是用来表示数据的特定规则
example:字典 总之是目录相关 

#### 优点
- 减少扫描的数据量 加速查询
- 减少或者完全消除数据库的排序操作 因为索引是有序的
- 将服务器的随机IO 变为顺序IO
#### 缺点
- 索引会占据额外的存储空间 包括磁盘和内存
- 由于数据需要排序 自然会影响到数据的更新（插入、更新、删除）的速度


## 实现原理及分类

#### 实现原理
- 误区：对于Mysql来说 服务层并不会去实现索引 而是交给了存储引擎 所以不同的存储引擎实现索引的方式就不一样
    - 故而InnoDB实现索引的方式是B+树

- 为什么选择B+树实现索引
    - 中间节点不保存真实数据 就可以存储更多的索引数据 以降低整体树的层级 减少磁盘IO的次数 提高查询性能
    - 所有的数据都保存在叶子节点 说明查询次数也是相同的 查询的稳定性更高
    - 叶子节点之间顺序链接在一起 范围查找的效率更高

#### 索引的分类
###### 普通索引
针对单个列创建的索引 之所以说他普通就是因为他对列值没什么限制 允许被索引的列包含重复的值
###### 主键索引
要求列值是唯一的 这个索引保证了数据记录的唯一性
###### 唯一索引
他是一种特殊的唯一索引 在一张表中只能定义一个但是 不是一定要定义 一个 
###### 联合索引
复合索引 将多个列值绑定在一起作为索引

tips:索引的分类是交叉的 唯一索引和主键索引也可以针对多个列做索引 他们可以是联合索引


## 创建高性能的索引

#### 聚簇索引
是InnoDB中特殊的概念 
-  她不是一种索引类型 而是一种存储数据的方式
- 他是将索引和数据存储在一起
- InnoDB规定一个表只能有一个聚簇索引 且会使用主键来创建

为啥InnoDB推荐自增的主键 
- 因为自增的主键连续增长特性 插入数据只需要向后追加 效率很高
- 如果使用字符类型的主键 在每一次插入数据的时候 不仅要找主键的位置 还需要移动主键位置后的数据
- 而这样做很可能造成B+树  的分裂与合并

聚簇索引与非聚簇索引的区别
- 聚簇索引 就是 索引即数据 所以如果以主键去查询数据 那么只需要一次索引就可查找完毕
- 非聚簇索引 实际上存储的是记录主键 所以需要根据主键再去做一次查找才能获取到数据 这就睡‘’非主键的二次查找“


####  联合索引
联合索引遵循最左前缀匹配原则
- 在检索数据的时候 从联合索引的最左边开始匹配

###### 联合索引的失效
- 索引列执行计算、函数、类型转换等操作
- 使用不等于（！=或<>）
- 使用is null  is not null
- like 以通配符（“%”）开头

注意：
Mysql还会对查询语句作处理 他会重新排列sql中的条件匹配顺序
``select * from xxx_table where type = 'B' AND salary > 2000``
``select * from xxx_table where salary > 2000 AND type = 'B'``

首先第一个语句是可以使用索引的
第二个实际上也是走索引的 因为此时Mysql可以帮助我们将查询的条件语句进行调整


#### 前缀索引
使用场景：
当我们发现表中的数据列是字符型的 且大多数长度都比较长 就可以考虑使用列值的一部分前缀作为索引， 这就是前缀索引

``ALTER TABLE table_name ADD KEY (column_name(prefix_length))``

索引选择性 是一个数值 
``不重复的值/所有的值``
范围介于0到1 1就是代表这一列唯一 没有重复的值








